{"ast":null,"code":"import _regeneratorRuntime from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/markgray/projects/todoodleoo/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'bootstrap';import axios from'axios';import'./board.css';import Themes from'./../Themes/Themes.js';import Backlog from'./../Backlog/Backlog.js';import Timeboxes from'./../Timeboxes/Timeboxes.js';import{DragDropContext}from'react-beautiful-dnd';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Board=/*#__PURE__*/function(_React$Component){_inherits(Board,_React$Component);var _super=_createSuper(Board);function Board(props){var _this;_classCallCheck(this,Board);_this=_super.call(this,props);_this.addTask=function(taskData){var newTask=_objectSpread({},taskData);_this.setState(function(prevState){return{tasks:[newTask].concat(_toConsumableArray(_this.state.tasks)),visibleTasks:[newTask].concat(_toConsumableArray(_this.state.tasks))};});};_this.addTimebox=function(timebox){_this.setState(function(prevState){return{timeboxes:[].concat(_toConsumableArray(_this.state.timeboxes),[timebox])};});};_this.addTheme=function(themeData){_this.setState(function(prevState){return{themes:[].concat(_toConsumableArray(_this.state.themes),[themeData])};});};_this.deleteTask=function(taskId){axios.post('/delete_task',{task_id:taskId,project_id:_this.state.projectId});var tasks=_this.state.tasks.filter(function(t){return t.id!==taskId;});_this.setState(function(prevState){return{tasks:tasks,visibleTasks:tasks};});};_this.deleteTheme=function(themeId){axios.post('/delete_theme',{theme_id:themeId,project_id:_this.state.projectId});var themes=_this.state.themes.filter(function(t){return t.id!==themeId;});_this.setState(function(prevState){return{themes:themes};});};_this.filterByTheme=function(theme){var filteredTasks=_this.state.tasks.filter(function(task){return task.theme===theme;});_this.setState(function(prevState){return{visibleTasks:filteredTasks,filtering:true};});};_this.clearFilters=function(){_this.setState({visibleTasks:_this.state.tasks,filtering:false});};_this.getTasks=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var resp,timeboxes,themes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/get_tasks?project_id=\".concat(projectId));case 2:resp=_context.sent;timeboxes=resp.data['timeboxes'];themes=resp.data['themes'];_this.setState({tasks:resp.data['tasks'],visibleTasks:resp.data['tasks'],themes:themes,timeboxes:timeboxes});case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.checkForInProgressTimeboxes=function(timeboxes){timeboxes.forEach(function(timebox){if(timebox.status==='In Progress'){_this.setState({timeboxRedirect:timebox.id,ipTimeboxName:timebox.title});}_this.setState({dataReceived:true});});};_this.onDragEnd=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){var destination,source,draggableId,taskId,obj,themeId,themeObj,timebox,newTasks,destinationList,otherTasks,backlogTasks;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:destination=result.destination,source=result.source,draggableId=result.draggableId;if(destination){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:if(!(//dragging and dropping into same place\ndestination.droppableId===source.droppableId&&destination.index===source.index)){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:taskId=Number(draggableId);obj=_this.state.tasks.find(function(o){return o.id===taskId;});if(destination.droppableId.slice(0,5)==='Theme'){//landed on a theme, keep timebox the same and update the theme\nthemeId=Number(destination.droppableId.slice(6,11));axios.post('/update_task_theme',{project_id:_this.state.projectId,task_id:taskId,theme_id:themeId});themeObj=_this.state.themes.find(function(o){return o.id===themeId;});obj.theme=themeObj.title;obj.theme_color=themeObj.color;}else if(destination.droppableId.slice(0,7)==='Timebox'){//landed in a timebox - get timebox, remove from tasks, update timebox and put back in new position\ntimebox=destination.droppableId.slice(8);axios.post('/update_task',{project_id:_this.state.projectId,task_id:taskId,priority:result.destination.index,timebox:timebox});obj.timebox=timebox;newTasks=_this.state.tasks.filter(function(t){return t!==obj;});newTasks.splice(result.destination.index,0,obj);_this.setState({tasks:newTasks,visibleTasks:newTasks});}else if(destination.droppableId==='Backlog'){//landed in backlog - remove from source list, add to backlog and update state with all the updated lists\naxios.post('/update_task',{project_id:_this.state.projectId,task_id:taskId,priority:result.destination.index,timebox:destination.droppableId});destinationList=_this.state.tasks.filter(function(t){return t.timebox===destination.droppableId;});otherTasks=_this.state.tasks.filter(function(t){return t.timebox!==destination.droppableId;});if(source.droppableId===destination.droppableId){//same list so simply take it out and put it bakc in new position\nbacklogTasks=_this.state.tasks.filter(function(t){return t.timebox===source.droppableId;});backlogTasks=_this.state.tasks.filter(function(t){return t!==obj;});backlogTasks.splice(result.destination.index,0,obj);_this.setState({tasks:backlogTasks,visibleTasks:backlogTasks});}else{//moving from timebox to backlog so remove from source, add to backlog at index and all tasks back to state\nobj.timebox='Backlog';_this.setState({tasks:[].concat(_toConsumableArray(otherTasks),_toConsumableArray(destinationList)),visibleTasks:[].concat(_toConsumableArray(otherTasks),_toConsumableArray(destinationList))});}}else{console.log('Unexpected drop destination');}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.state={dataReceived:false};return _this;}_createClass(Board,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var sp,projectId;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:sp=new URLSearchParams(this.props.location.query);projectId=Number(sp.get(\"projectId\"));if(!(projectId===null||projectId===0)){_context3.next=6;break;}this.props.history.push('/');_context3.next=10;break;case 6:this.setState({projectId:projectId});_context3.next=9;return this.getTasks(projectId);case 9:this.checkForInProgressTimeboxes(this.state.timeboxes);//why is this function essential for rendrering anything????\ncase 10:case\"end\":return _context3.stop();}}},_callee3,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){return this.state.dataReceived===true?/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:this.onDragEnd,onDragUpdate:this.onDragUpdate,children:/*#__PURE__*/_jsxs(\"div\",{className:\"board row mt-5\",style:{margin:0},children:[/*#__PURE__*/_jsx(Themes,{themes:this.state.themes,filterByTheme:this.filterByTheme,projectId:this.state.projectId,addTheme:this.addTheme,deleteTheme:this.deleteTheme,filtering:this.state.filtering,clearFilters:this.clearFilters}),/*#__PURE__*/_jsx(Backlog,{projectId:this.state.projectId,tasks:this.state.visibleTasks,addTask:this.addTask,deleteTask:this.deleteTask}),/*#__PURE__*/_jsx(Timeboxes,{addTimebox:this.addTimebox,timeboxes:this.state.timeboxes,tasks:this.state.visibleTasks,projectId:this.state.projectId})]})}):/*#__PURE__*/_jsx(\"div\",{});}}]);return Board;}(React.Component);export{Board};","map":{"version":3,"sources":["/Users/markgray/projects/todoodleoo/src/Board/Board.js"],"names":["React","axios","Themes","Backlog","Timeboxes","DragDropContext","Board","props","addTask","taskData","newTask","setState","prevState","tasks","state","visibleTasks","addTimebox","timebox","timeboxes","addTheme","themeData","themes","deleteTask","taskId","post","task_id","project_id","projectId","filter","t","id","deleteTheme","themeId","theme_id","filterByTheme","theme","filteredTasks","task","filtering","clearFilters","getTasks","get","resp","data","checkForInProgressTimeboxes","forEach","status","timeboxRedirect","ipTimeboxName","title","dataReceived","onDragEnd","result","destination","source","draggableId","droppableId","index","Number","obj","find","o","slice","themeObj","theme_color","color","priority","newTasks","splice","destinationList","otherTasks","backlogTasks","console","log","sp","URLSearchParams","location","query","history","push","onDragUpdate","margin","Component"],"mappings":"o6BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,WAAP,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,aAAP,CACA,MAAOC,CAAAA,MAAP,KAAmB,uBAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,yBAApB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,OAASC,eAAT,KAAgC,qBAAhC,C,2FAEMC,CAAAA,K,0GACL,eAAYC,KAAZ,CAAmB,uCACf,uBAAMA,KAAN,EADe,MAOnBC,OAPmB,CAOT,SAACC,QAAD,CAAc,CACvB,GAAMC,CAAAA,OAAO,kBAAOD,QAAP,CAAb,CACA,MAAKE,QAAL,CAAc,SAAAC,SAAS,QAAK,CACxBC,KAAK,EAAGH,OAAH,4BAAe,MAAKI,KAAL,CAAWD,KAA1B,EADmB,CAExBE,YAAY,EAAGL,OAAH,4BAAe,MAAKI,KAAL,CAAWD,KAA1B,EAFY,CAAL,EAAvB,EAIE,CAbgB,OAejBG,UAfiB,CAeJ,SAACC,OAAD,CAAa,CACzB,MAAKN,QAAL,CAAc,SAAAC,SAAS,QAAK,CAC1BM,SAAS,8BAAM,MAAKJ,KAAL,CAAWI,SAAjB,GAA4BD,OAA5B,EADiB,CAAL,EAAvB,EAGA,CAnBgB,OAqBjBE,QArBiB,CAqBN,SAACC,SAAD,CAAe,CACzB,MAAKT,QAAL,CAAc,SAAAC,SAAS,QAAK,CAC1BS,MAAM,8BAAM,MAAKP,KAAL,CAAWO,MAAjB,GAAyBD,SAAzB,EADoB,CAAL,EAAvB,EAGA,CAzBgB,OA2BjBE,UA3BiB,CA2BJ,SAACC,MAAD,CAAY,CACxBtB,KAAK,CAACuB,IAAN,CAAW,cAAX,CAA2B,CAC1BC,OAAO,CAAEF,MADiB,CAE1BG,UAAU,CAAE,MAAKZ,KAAL,CAAWa,SAFG,CAA3B,EAIA,GAAMd,CAAAA,KAAK,CAAG,MAAKC,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACC,EAAF,GAASP,MAAb,EAAzB,CAAd,CACA,MAAKZ,QAAL,CAAc,SAAAC,SAAS,QAAK,CACzBC,KAAK,CAAEA,KADkB,CAEzBE,YAAY,CAAEF,KAFW,CAAL,EAAvB,EAIA,CArCgB,OAuCjBkB,WAvCiB,CAuCH,SAACC,OAAD,CAAa,CAC1B/B,KAAK,CAACuB,IAAN,CAAW,eAAX,CAA4B,CAC3BS,QAAQ,CAAED,OADiB,CAE3BN,UAAU,CAAE,MAAKZ,KAAL,CAAWa,SAFI,CAA5B,EAIA,GAAMN,CAAAA,MAAM,CAAG,MAAKP,KAAL,CAAWO,MAAX,CAAkBO,MAAlB,CAAyB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACC,EAAF,GAASE,OAAb,EAA1B,CAAf,CACA,MAAKrB,QAAL,CAAc,SAAAC,SAAS,QAAK,CACzBS,MAAM,CAAEA,MADiB,CAAL,EAAvB,EAGA,CAhDgB,OAkDjBa,aAlDiB,CAkDD,SAACC,KAAD,CAAW,CACzB,GAAMC,CAAAA,aAAa,CAAG,MAAKtB,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAS,IAAI,QAAIA,CAAAA,IAAI,CAACF,KAAL,GAAeA,KAAnB,EAA5B,CAAtB,CACA,MAAKxB,QAAL,CAAc,SAAAC,SAAS,QAAK,CAC1BG,YAAY,CAAEqB,aADY,CAE1BE,SAAS,CAAE,IAFe,CAAL,EAAvB,EAID,CAxDgB,OA0DjBC,YA1DiB,CA0DF,UAAM,CACpB,MAAK5B,QAAL,CAAc,CAACI,YAAY,CAAE,MAAKD,KAAL,CAAWD,KAA1B,CAAiCyB,SAAS,CAAE,KAA5C,CAAd,EACA,CA5DgB,OA8DjBE,QA9DiB,0FA8DN,iBAAOb,SAAP,kKACS1B,CAAAA,KAAK,CAACwC,GAAN,iCAAmCd,SAAnC,EADT,QACJe,IADI,eAEJxB,SAFI,CAEQwB,IAAI,CAACC,IAAL,CAAU,WAAV,CAFR,CAGJtB,MAHI,CAGKqB,IAAI,CAACC,IAAL,CAAU,QAAV,CAHL,CAIV,MAAKhC,QAAL,CAAc,CAAEE,KAAK,CAAE6B,IAAI,CAACC,IAAL,CAAU,OAAV,CAAT,CACN5B,YAAY,CAAE2B,IAAI,CAACC,IAAL,CAAU,OAAV,CADR,CAENtB,MAAM,CAACA,MAFD,CAGNH,SAAS,CAAEA,SAHL,CAAd,EAJU,sDA9DM,qEAyEjB0B,2BAzEiB,CAyEa,SAAC1B,SAAD,CAAe,CAC5CA,SAAS,CAAC2B,OAAV,CAAkB,SAAA5B,OAAO,CAAI,CAC5B,GAAIA,OAAO,CAAC6B,MAAR,GAAmB,aAAvB,CAAsC,CACrC,MAAKnC,QAAL,CAAc,CAACoC,eAAe,CAAE9B,OAAO,CAACa,EAA1B,CAA8BkB,aAAa,CAAE/B,OAAO,CAACgC,KAArD,CAAd,EACA,CACD,MAAKtC,QAAL,CAAc,CAACuC,YAAY,CAAE,IAAf,CAAd,EACA,CALD,EAOA,CAjFgB,OAgGhBC,SAhGgB,2FAgGJ,kBAAOC,MAAP,8OAELC,WAFK,CAE+BD,MAF/B,CAELC,WAFK,CAEQC,MAFR,CAE+BF,MAF/B,CAEQE,MAFR,CAEgBC,WAFhB,CAE+BH,MAF/B,CAEgBG,WAFhB,IAIPF,WAJO,wEAUX;AACAA,WAAW,CAACG,WAAZ,GAA4BF,MAAM,CAACE,WAAnC,EACAH,WAAW,CAACI,KAAZ,GAAsBH,MAAM,CAACG,KAZlB,oEAiBNlC,MAjBM,CAiBGmC,MAAM,CAACH,WAAD,CAjBT,CAkBNI,GAlBM,CAkBA,MAAK7C,KAAL,CAAWD,KAAX,CAAiB+C,IAAjB,CAAsB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC/B,EAAF,GAASP,MAAb,EAAvB,CAlBA,CAoBZ,GAAI8B,WAAW,CAACG,WAAZ,CAAwBM,KAAxB,CAA8B,CAA9B,CAAgC,CAAhC,IAAuC,OAA3C,CAAoD,CACnD;AACM9B,OAF6C,CAEnC0B,MAAM,CAACL,WAAW,CAACG,WAAZ,CAAwBM,KAAxB,CAA8B,CAA9B,CAAgC,EAAhC,CAAD,CAF6B,CAGnD7D,KAAK,CAACuB,IAAN,CAAW,oBAAX,CAAiC,CACjCE,UAAU,CAAE,MAAKZ,KAAL,CAAWa,SADU,CAEjCF,OAAO,CAAEF,MAFwB,CAGjCU,QAAQ,CAAED,OAHuB,CAAjC,EAMM+B,QAT6C,CASlC,MAAKjD,KAAL,CAAWO,MAAX,CAAkBuC,IAAlB,CAAuB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC/B,EAAF,GAASE,OAAb,EAAxB,CATkC,CAWnD2B,GAAG,CAACxB,KAAJ,CAAY4B,QAAQ,CAACd,KAArB,CACAU,GAAG,CAACK,WAAJ,CAAkBD,QAAQ,CAACE,KAA3B,CAEA,CAdD,IAgBK,IAAIZ,WAAW,CAACG,WAAZ,CAAwBM,KAAxB,CAA8B,CAA9B,CAAgC,CAAhC,IAAuC,SAA3C,CAAsD,CAC1D;AACM7C,OAFoD,CAE1CoC,WAAW,CAACG,WAAZ,CAAwBM,KAAxB,CAA8B,CAA9B,CAF0C,CAI1D7D,KAAK,CAACuB,IAAN,CAAW,cAAX,CAA2B,CAC1BE,UAAU,CAAE,MAAKZ,KAAL,CAAWa,SADG,CAE1BF,OAAO,CAAEF,MAFiB,CAG1B2C,QAAQ,CAAEd,MAAM,CAACC,WAAP,CAAmBI,KAHH,CAI1BxC,OAAO,CAAEA,OAJiB,CAA3B,EAOA0C,GAAG,CAAC1C,OAAJ,CAAcA,OAAd,CAEMkD,QAboD,CAazC,MAAKrD,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK8B,GAAV,EAAzB,CAbyC,CAc3DQ,QAAQ,CAACC,MAAT,CAAgBhB,MAAM,CAACC,WAAP,CAAmBI,KAAnC,CAAyC,CAAzC,CAA4CE,GAA5C,EACA,MAAKhD,QAAL,CAAc,CACXE,KAAK,CAAEsD,QADI,CAEXpD,YAAY,CAAEoD,QAFH,CAAd,EAIA,CAnBK,IAqBD,IAAId,WAAW,CAACG,WAAZ,GAA4B,SAAhC,CAA2C,CAC/C;AACEvD,KAAK,CAACuB,IAAN,CAAW,cAAX,CAA2B,CAC5BE,UAAU,CAAE,MAAKZ,KAAL,CAAWa,SADK,CAE5BF,OAAO,CAAEF,MAFmB,CAG5B2C,QAAQ,CAAEd,MAAM,CAACC,WAAP,CAAmBI,KAHD,CAI5BxC,OAAO,CAAEoC,WAAW,CAACG,WAJO,CAA3B,EAOIa,eATyC,CASvB,MAAKvD,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACZ,OAAF,GAAcoC,WAAW,CAACG,WAA9B,EAAzB,CATuB,CAUzCc,UAVyC,CAU5B,MAAKxD,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACZ,OAAF,GAAcoC,WAAW,CAACG,WAA9B,EAAzB,CAV4B,CAYhD,GAAIF,MAAM,CAACE,WAAP,GAAuBH,WAAW,CAACG,WAAvC,CAAoD,CACnD;AACIe,YAF+C,CAEhC,MAAKzD,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACZ,OAAF,GAAcqC,MAAM,CAACE,WAAzB,EAAzB,CAFgC,CAGnDe,YAAY,CAAG,MAAKzD,KAAL,CAAWD,KAAX,CAAiBe,MAAjB,CAAwB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK8B,GAAV,EAAzB,CAAf,CAEAY,YAAY,CAACH,MAAb,CAAoBhB,MAAM,CAACC,WAAP,CAAmBI,KAAvC,CAA6C,CAA7C,CAAgDE,GAAhD,EACA,MAAKhD,QAAL,CAAc,CACXE,KAAK,CAAE0D,YADI,CAEXxD,YAAY,CAAEwD,YAFH,CAAd,EAKA,CAXD,IAWO,CACN;AACAZ,GAAG,CAAC1C,OAAJ,CAAc,SAAd,CAEA,MAAKN,QAAL,CAAc,CACXE,KAAK,8BAAMyD,UAAN,qBAAqBD,eAArB,EADM,CAEXtD,YAAY,8BAAOuD,UAAP,qBAAsBD,eAAtB,EAFD,CAAd,EAIA,CACD,CAhCK,IAgCC,CACNG,OAAO,CAACC,GAAR,CAAY,6BAAZ,EACA,CA3Fa,wDAhGI,iEAEf,MAAK3D,KAAL,CAAa,CACToC,YAAY,CAAE,KADL,CAAb,CAFe,aAKhB,C,6IA8EA,yJACOwB,EADP,CACY,GAAIC,CAAAA,eAAJ,CAAoB,KAAKpE,KAAL,CAAWqE,QAAX,CAAoBC,KAAxC,CADZ,CAEKlD,SAFL,CAEiB+B,MAAM,CAACgB,EAAE,CAACjC,GAAH,CAAO,WAAP,CAAD,CAFvB,MAGGd,SAAS,GAAK,IAAd,EAAsBA,SAAS,GAAK,CAHvC,2BAIA,KAAKpB,KAAL,CAAWuE,OAAX,CAAmBC,IAAnB,CAAwB,GAAxB,EAJA,+BAMA,KAAKpE,QAAL,CAAc,CAACgB,SAAS,CAAEA,SAAZ,CAAd,EANA,uBAOM,MAAKa,QAAL,CAAcb,SAAd,CAPN,QAQA,KAAKiB,2BAAL,CAAiC,KAAK9B,KAAL,CAAWI,SAA5C,EAAuD;AARvD,8D,mIA6GH,iBAAS,CACR,MAAS,MAAKJ,KAAL,CAAWoC,YAAX,GAA4B,IAA5B,cACL,KAAC,eAAD,EACC,SAAS,CAAI,KAAKC,SADnB,CAEC,YAAY,CAAE,KAAK6B,YAFpB,uBAIC,aAAK,SAAS,CAAC,gBAAf,CAAgC,KAAK,CAAE,CAACC,MAAM,CAAE,CAAT,CAAvC,wBACC,KAAC,MAAD,EACC,MAAM,CAAE,KAAKnE,KAAL,CAAWO,MADpB,CAEC,aAAa,CAAE,KAAKa,aAFrB,CAGC,SAAS,CAAE,KAAKpB,KAAL,CAAWa,SAHvB,CAIC,QAAQ,CAAE,KAAKR,QAJhB,CAKC,WAAW,CAAE,KAAKY,WALnB,CAMC,SAAS,CAAE,KAAKjB,KAAL,CAAWwB,SANvB,CAOC,YAAY,CAAE,KAAKC,YAPpB,EADD,cAUC,KAAC,OAAD,EACC,SAAS,CAAE,KAAKzB,KAAL,CAAWa,SADvB,CAEE,KAAK,CAAE,KAAKb,KAAL,CAAWC,YAFpB,CAGE,OAAO,CAAE,KAAKP,OAHhB,CAIE,UAAU,CAAE,KAAKc,UAJnB,EAVD,cAgBC,KAAC,SAAD,EACC,UAAU,CAAE,KAAKN,UADlB,CAEC,SAAS,CAAE,KAAKF,KAAL,CAAWI,SAFvB,CAGC,KAAK,CAAE,KAAKJ,KAAL,CAAWC,YAHnB,CAIC,SAAS,CAAE,KAAKD,KAAL,CAAWa,SAJvB,EAhBD,GAJD,EADK,cA8BJ,cA9BL,CA+BA,C,mBAjOkB3B,KAAK,CAACkF,S,EAqO1B,OAAS5E,KAAT","sourcesContent":["import React from 'react';\nimport 'bootstrap';\nimport axios from 'axios';\nimport './board.css';\nimport Themes from './../Themes/Themes.js'\nimport Backlog from './../Backlog/Backlog.js'\nimport Timeboxes from './../Timeboxes/Timeboxes.js'\nimport { DragDropContext } from 'react-beautiful-dnd';\n\nclass Board extends React.Component {\n\tconstructor(props) {\n\t    super(props);\n\t    this.state = {\n\t        dataReceived: false\n\t    };\n\t  }\n\n\taddTask = (taskData) => {\n\t\tconst newTask = {...taskData}\n\t\tthis.setState(prevState => ({\n    \t\ttasks: [newTask, ...this.state.tasks],\n    \t\tvisibleTasks: [newTask, ...this.state.tasks]\n    \t}));\n  \t};\n\n  \taddTimebox = (timebox) => {\n  \t\tthis.setState(prevState => ({\n    \t\ttimeboxes: [...this.state.timeboxes, timebox]\n    \t}));\n  \t}\n\n  \taddTheme = (themeData) => {\n  \t\tthis.setState(prevState => ({\n    \t\tthemes: [...this.state.themes, themeData],\n    \t\t}));\n  \t}\n\n  \tdeleteTask = (taskId) => {\n  \t\taxios.post('/delete_task', {\n  \t\t\ttask_id: taskId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t})\n  \t\tconst tasks = this.state.tasks.filter(t => t.id !== taskId)\n  \t\tthis.setState(prevState => ({\n\t\t    \ttasks: tasks,\n\t\t    \tvisibleTasks: tasks\n\t\t    }));\n  \t}\n\n  \tdeleteTheme = (themeId) => {\n  \t\taxios.post('/delete_theme', {\n  \t\t\ttheme_id: themeId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t})\n  \t\tconst themes = this.state.themes.filter(t => t.id !== themeId)\n  \t\tthis.setState(prevState => ({\n\t\t    \tthemes: themes,\n\t\t    }));\n  \t}\n\n  \tfilterByTheme = (theme) => {\n\t  \t\tconst filteredTasks = this.state.tasks.filter(task => task.theme === theme);\n\t  \t\tthis.setState(prevState => ({\n\t\t    \tvisibleTasks: filteredTasks,\n\t\t    \tfiltering: true\n\t\t    }));\t\n  \t}\n\n  \tclearFilters = () => {\n  \t\tthis.setState({visibleTasks: this.state.tasks, filtering: false})\n  \t}\n\n  \tgetTasks = async (projectId) => {\n    const resp = await axios.get(`/get_tasks?project_id=${projectId}`)\n    const timeboxes = resp.data['timeboxes']\n    const themes = resp.data['themes']\n    this.setState({ tasks: resp.data['tasks'],\n    \t\t\t\t\t\t\t\tvisibleTasks: resp.data['tasks'], \n    \t\t\t\t\t\t\t\tthemes:themes, \n    \t\t\t\t\t\t\t\ttimeboxes: timeboxes \n    \t\t\t\t\t\t\t});\n  };\n\n  \tcheckForInProgressTimeboxes = (timeboxes) => {\n  \t\ttimeboxes.forEach(timebox => {\n    \tif (timebox.status === 'In Progress') {\n    \t\tthis.setState({timeboxRedirect: timebox.id, ipTimeboxName: timebox.title})\n    \t}\n    \tthis.setState({dataReceived: true})\n    })\n\n  \t}\n  \t\n   \tasync componentDidMount() {\n   \t\tconst sp = new URLSearchParams(this.props.location.query);\n\t\t\tconst projectId = Number(sp.get(\"projectId\"))\n\t\t\tif (projectId === null || projectId === 0) {\n\t\t\t\tthis.props.history.push('/')\n\t\t\t} else {\n\t\t\t\tthis.setState({projectId: projectId})\n\t\t\t\tawait this.getTasks(projectId);\n\t\t\t\tthis.checkForInProgressTimeboxes(this.state.timeboxes) //why is this function essential for rendrering anything????\n\t\t\t}\n    \t\n    }\n\n    onDragEnd = async (result) => {\n\n  \t\tconst {destination, source, draggableId} = result;\n\n  \t\tif (!destination) {\n  \t\t\t//dragging somewhere non-droppable\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (\n  \t\t\t//dragging and dropping into same place\n  \t\t\tdestination.droppableId === source.droppableId &&\n  \t\t\tdestination.index === source.index\n  \t\t\t) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tconst taskId = Number(draggableId)\n  \t\tconst obj = this.state.tasks.find(o => o.id === taskId);\n\n  \t\tif (destination.droppableId.slice(0,5) === 'Theme') {\n  \t\t\t//landed on a theme, keep timebox the same and update the theme\n  \t\t\tconst themeId = Number(destination.droppableId.slice(6,11))\n  \t\t\taxios.post('/update_task_theme', {\n  \t\t\tproject_id: this.state.projectId,\n  \t\t\ttask_id: taskId,\n  \t\t\ttheme_id: themeId\n  \t\t\t})\n\n\t  \t\tconst themeObj = this.state.themes.find(o => o.id === themeId)\n\n\t  \t\tobj.theme = themeObj.title\n\t  \t\tobj.theme_color = themeObj.color\n\n  \t\t} \n\n  \t\telse if (destination.droppableId.slice(0,7) === 'Timebox') {\n  \t\t\t//landed in a timebox - get timebox, remove from tasks, update timebox and put back in new position\n  \t\t\tconst timebox = destination.droppableId.slice(8,)\n\n  \t\t\taxios.post('/update_task', {\n\t  \t\t\tproject_id: this.state.projectId,\n\t  \t\t\ttask_id: taskId,\n\t  \t\t\tpriority: result.destination.index,\n\t  \t\t\ttimebox: timebox\n\t  \t\t})\n\n\t  \t\tobj.timebox = timebox\n\n\t\t  \tconst newTasks = this.state.tasks.filter(t => t !== obj)\n\t\t\t\tnewTasks.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: newTasks,\n\t\t    \tvisibleTasks: newTasks\n\t\t    \t})\n\t\t\t}\n\n\t\t\telse if (destination.droppableId === 'Backlog') {\n\t\t\t\t//landed in backlog - remove from source list, add to backlog and update state with all the updated lists\n  \t\t  axios.post('/update_task', {\n  \t\t\tproject_id: this.state.projectId,\n  \t\t\ttask_id: taskId,\n  \t\t\tpriority: result.destination.index,\n  \t\t\ttimebox: destination.droppableId\n  \t\t})\n\t  \t\n\t  \tconst destinationList = this.state.tasks.filter(t => t.timebox === destination.droppableId);\n\t  \tconst otherTasks = this.state.tasks.filter(t => t.timebox !== destination.droppableId);\n\t\t\t\n\t\t\tif (source.droppableId === destination.droppableId) {\n\t\t\t\t//same list so simply take it out and put it bakc in new position\n\t\t\t\tlet backlogTasks = this.state.tasks.filter(t => t.timebox === source.droppableId);\n\t\t\t\tbacklogTasks = this.state.tasks.filter(t => t !== obj);\n\t\t\t\t\t\t\n\t\t\t\tbacklogTasks.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: backlogTasks,\n\t\t    \tvisibleTasks: backlogTasks\n\t\t    \t})\n\n\t\t\t} else {\n\t\t\t\t//moving from timebox to backlog so remove from source, add to backlog at index and all tasks back to state\n\t\t\t\tobj.timebox = 'Backlog'\n\n\t\t\t\tthis.setState({\n\t\t    \ttasks: [...otherTasks, ...destinationList],\n\t\t    \tvisibleTasks: [ ...otherTasks, ...destinationList]\n\t\t    \t})\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('Unexpected drop destination')\n\t\t}\n  \t\t\t\t\n  \t}\n\n\n\trender() {\n\t\treturn   this.state.dataReceived === true ? (\n\t\t\t\t\t\t<DragDropContext\n\t\t\t\t\t\t\tonDragEnd = {this.onDragEnd}\n\t\t\t\t\t\t\tonDragUpdate={this.onDragUpdate}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className='board row mt-5' style={{margin: 0}}>\n\t\t\t\t\t\t\t\t<Themes \n\t\t\t\t\t\t\t\t\tthemes={this.state.themes} \n\t\t\t\t\t\t\t\t\tfilterByTheme={this.filterByTheme} \n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t\taddTheme={this.addTheme}\n\t\t\t\t\t\t\t\t\tdeleteTheme={this.deleteTheme}\n\t\t\t\t\t\t\t\t\tfiltering={this.state.filtering}\n\t\t\t\t\t\t\t\t\tclearFilters={this.clearFilters}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Backlog \n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t  tasks={this.state.visibleTasks}\n\t\t\t\t\t\t\t\t  addTask={this.addTask}\n\t\t\t\t\t\t\t\t  deleteTask={this.deleteTask}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Timeboxes \n\t\t\t\t\t\t\t\t\taddTimebox={this.addTimebox}\n\t\t\t\t\t\t\t\t\ttimeboxes={this.state.timeboxes}\n\t\t\t\t\t\t\t\t\ttasks={this.state.visibleTasks}\n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t/>\t\t\n\t\t\t\t\t\t \t</div>\n\t\t\t\t\t\t</DragDropContext> \n\t\t\t\t\t\t)\n\t\t\t\t\t: <div></div>\n\t}\n}\n\n\nexport { Board }\n"]},"metadata":{},"sourceType":"module"}
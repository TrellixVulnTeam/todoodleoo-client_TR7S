{"ast":null,"code":"import _regeneratorRuntime from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/markgray/projects/Todoodleoo/todoodleoo-client/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'bootstrap';import'./board.css';import{getRequest,postRequest}from'./../API/api.js';import Themes from'./../Themes/Themes.js';import Backlog from'./../Backlog/Backlog.js';import Timeboxes from'./../Timeboxes/Timeboxes.js';import{DragDropContext}from'react-beautiful-dnd';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Board=/*#__PURE__*/function(_React$Component){_inherits(Board,_React$Component);var _super=_createSuper(Board);function Board(props){var _this;_classCallCheck(this,Board);_this=_super.call(this,props);_this.addTask=function(taskData){var newTask=_objectSpread({},taskData);_this.setState(function(prevState){return{tasks:[newTask].concat(_toConsumableArray(_this.state.tasks)),visibleTasks:[newTask].concat(_toConsumableArray(_this.state.tasks))};});};_this.addTimebox=function(timebox){_this.setState(function(prevState){return{timeboxes:[].concat(_toConsumableArray(_this.state.timeboxes),[timebox])};});};_this.addTheme=function(themeData){_this.setState(function(prevState){return{themes:[].concat(_toConsumableArray(_this.state.themes),[themeData])};});};_this.deleteTask=function(taskId){var data={task_id:taskId,project_id:_this.state.projectId};var r=postRequest('/delete_task',data);var tasks=_this.state.tasks.filter(function(t){return t.id!==taskId;});_this.setState(function(prevState){return{tasks:tasks,visibleTasks:tasks};});};_this.deleteTheme=function(themeId){var data={theme_id:themeId,project_id:_this.state.projectId};postRequest('/delete_theme',data);var themes=_this.state.themes.filter(function(t){return t.id!==themeId;});_this.setState(function(prevState){return{themes:themes};});};_this.filterByTheme=function(theme){var filteredTasks=_this.state.tasks.filter(function(task){return task.theme===theme;});_this.setState(function(prevState){return{visibleTasks:filteredTasks,filtering:true};});};_this.clearFilters=function(){_this.setState({visibleTasks:_this.state.tasks,filtering:false});};_this.getTasks=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var resp,timeboxes,themes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getRequest('/get_tasks',\"project_id=\".concat(projectId));case 2:resp=_context.sent;timeboxes=resp.data['timeboxes'];themes=resp.data['themes'];_this.setState({tasks:resp.data['tasks'],visibleTasks:resp.data['tasks'],themes:themes,timeboxes:timeboxes});case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.checkForInProgressTimeboxes=function(timeboxes){timeboxes.forEach(function(timebox){if(timebox.status==='In Progress'){_this.setState({timeboxRedirect:timebox.id,ipTimeboxName:timebox.title});}_this.setState({dataReceived:true});});};_this.onDragEnd=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){var destination,source,draggableId,taskId,obj,themeId,data,themeObj,timebox,_data,newTasks,_data2,destinationList,otherTasks,backlogTasks;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:destination=result.destination,source=result.source,draggableId=result.draggableId;if(destination){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:if(!(//dragging and dropping into same place\ndestination.droppableId===source.droppableId&&destination.index===source.index)){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:taskId=Number(draggableId);obj=_this.state.tasks.find(function(o){return o.id===taskId;});if(destination.droppableId.slice(0,5)==='Theme'){//landed on a theme, keep timebox the same and update the theme\nthemeId=Number(destination.droppableId.slice(6,11));data={project_id:_this.state.projectId,task_id:taskId,theme_id:themeId};postRequest('/update_task_theme',data);themeObj=_this.state.themes.find(function(o){return o.id===themeId;});obj.theme=themeObj.title;obj.theme_color=themeObj.color;}else if(destination.droppableId.slice(0,7)==='Timebox'){//landed in a timebox - get timebox, remove from tasks, update timebox and put back in new position\ntimebox=destination.droppableId.slice(8);_data={project_id:_this.state.projectId,task_id:taskId,priority:result.destination.index,timebox:timebox};postRequest('/update_task',_data);obj.timebox=timebox;newTasks=_this.state.tasks.filter(function(t){return t!==obj;});newTasks.splice(result.destination.index,0,obj);_this.setState({tasks:newTasks,visibleTasks:newTasks});}else if(destination.droppableId==='Backlog'){//landed in backlog - remove from source list, add to backlog and update state with all the updated lists\n_data2={project_id:_this.state.projectId,task_id:taskId,priority:result.destination.index,timebox:destination.droppableId};postRequest('/update_task',_data2);destinationList=_this.state.tasks.filter(function(t){return t.timebox===destination.droppableId;});otherTasks=_this.state.tasks.filter(function(t){return t.timebox!==destination.droppableId;});if(source.droppableId===destination.droppableId){//same list so simply take it out and put it bakc in new position\nbacklogTasks=_this.state.tasks.filter(function(t){return t.timebox===source.droppableId;});backlogTasks=_this.state.tasks.filter(function(t){return t!==obj;});backlogTasks.splice(result.destination.index,0,obj);_this.setState({tasks:backlogTasks,visibleTasks:backlogTasks});}else{//moving from timebox to backlog so remove from source, add to backlog at index and all tasks back to state\nobj.timebox='Backlog';_this.setState({tasks:[].concat(_toConsumableArray(otherTasks),_toConsumableArray(destinationList)),visibleTasks:[].concat(_toConsumableArray(otherTasks),_toConsumableArray(destinationList))});}}else{console.log('Unexpected drop destination');}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.state={dataReceived:false};return _this;}_createClass(Board,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var sp,projectId;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:sp=new URLSearchParams(this.props.location.query);projectId=Number(sp.get(\"projectId\"));if(!(projectId===null||projectId===0)){_context3.next=6;break;}this.props.history.push('/');_context3.next=10;break;case 6:this.setState({projectId:projectId});_context3.next=9;return this.getTasks(projectId);case 9:this.checkForInProgressTimeboxes(this.state.timeboxes);//why is this function essential for rendrering anything????\ncase 10:case\"end\":return _context3.stop();}}},_callee3,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){return this.state.dataReceived===true?/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:this.onDragEnd,onDragUpdate:this.onDragUpdate,children:/*#__PURE__*/_jsxs(\"div\",{className:\"board row mt-5\",style:{margin:0},children:[/*#__PURE__*/_jsx(Themes,{themes:this.state.themes,filterByTheme:this.filterByTheme,projectId:this.state.projectId,addTheme:this.addTheme,deleteTheme:this.deleteTheme,filtering:this.state.filtering,clearFilters:this.clearFilters}),/*#__PURE__*/_jsx(Backlog,{projectId:this.state.projectId,tasks:this.state.visibleTasks,addTask:this.addTask,deleteTask:this.deleteTask}),/*#__PURE__*/_jsx(Timeboxes,{addTimebox:this.addTimebox,timeboxes:this.state.timeboxes,tasks:this.state.visibleTasks,projectId:this.state.projectId})]})}):/*#__PURE__*/_jsx(\"div\",{});}}]);return Board;}(React.Component);export{Board};","map":{"version":3,"sources":["/Users/markgray/projects/Todoodleoo/todoodleoo-client/src/Board/Board.js"],"names":["React","getRequest","postRequest","Themes","Backlog","Timeboxes","DragDropContext","Board","props","addTask","taskData","newTask","setState","prevState","tasks","state","visibleTasks","addTimebox","timebox","timeboxes","addTheme","themeData","themes","deleteTask","taskId","data","task_id","project_id","projectId","r","filter","t","id","deleteTheme","themeId","theme_id","filterByTheme","theme","filteredTasks","task","filtering","clearFilters","getTasks","resp","checkForInProgressTimeboxes","forEach","status","timeboxRedirect","ipTimeboxName","title","dataReceived","onDragEnd","result","destination","source","draggableId","droppableId","index","Number","obj","find","o","slice","themeObj","theme_color","color","priority","newTasks","splice","destinationList","otherTasks","backlogTasks","console","log","sp","URLSearchParams","location","query","get","history","push","onDragUpdate","margin","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'bootstrap';\nimport './board.css';\nimport { getRequest, postRequest }from './../API/api.js'\nimport Themes from './../Themes/Themes.js'\nimport Backlog from './../Backlog/Backlog.js'\nimport Timeboxes from './../Timeboxes/Timeboxes.js'\nimport { DragDropContext } from 'react-beautiful-dnd';\n\nclass Board extends React.Component {\n\tconstructor(props) {\n\t    super(props);\n\t    this.state = {\n\t        dataReceived: false\n\t    };\n\t  }\n\n\taddTask = (taskData) => {\n\t\tconst newTask = {...taskData}\n\t\tthis.setState(prevState => ({\n    \t\ttasks: [newTask, ...this.state.tasks],\n    \t\tvisibleTasks: [newTask, ...this.state.tasks]\n    \t}));\n  \t};\n\n  \taddTimebox = (timebox) => {\n  \t\tthis.setState(prevState => ({\n    \t\ttimeboxes: [...this.state.timeboxes, timebox]\n    \t}));\n  \t}\n\n  \taddTheme = (themeData) => {\n  \t\tthis.setState(prevState => ({\n    \t\tthemes: [...this.state.themes, themeData],\n    \t\t}));\n  \t}\n\n  \tdeleteTask = (taskId) => {\n\t\t\tconst data = {\n  \t\t\ttask_id: taskId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t}\n\t\t\tconst r = postRequest('/delete_task', data)\n  \t\tconst tasks = this.state.tasks.filter(t => t.id !== taskId)\n  \t\tthis.setState(prevState => ({\n\t\t    \ttasks: tasks,\n\t\t    \tvisibleTasks: tasks\n\t\t    }));\n  \t}\n\n  \tdeleteTheme = (themeId) => {\n\t\t\tconst data = {\n  \t\t\ttheme_id: themeId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t}\n\t\t\tpostRequest('/delete_theme', data)\n  \t\tconst themes = this.state.themes.filter(t => t.id !== themeId)\n  \t\tthis.setState(prevState => ({\n\t\t    \tthemes: themes,\n\t\t    }));\n  \t}\n\n  \tfilterByTheme = (theme) => {\n\t  \t\tconst filteredTasks = this.state.tasks.filter(task => task.theme === theme);\n\t  \t\tthis.setState(prevState => ({\n\t\t    \tvisibleTasks: filteredTasks,\n\t\t    \tfiltering: true\n\t\t    }));\n  \t}\n\n  \tclearFilters = () => {\n  \t\tthis.setState({visibleTasks: this.state.tasks, filtering: false})\n  \t}\n\n  \tgetTasks = async (projectId) => {\n\t\t\tconst resp = await getRequest('/get_tasks', `project_id=${projectId}`)\n\t    const timeboxes = resp.data['timeboxes']\n\t    const themes = resp.data['themes']\n\t    this.setState({ tasks: resp.data['tasks'],\n\t    \t\t\t\t\t\t\t\tvisibleTasks: resp.data['tasks'],\n\t    \t\t\t\t\t\t\t\tthemes:themes,\n\t    \t\t\t\t\t\t\t\ttimeboxes: timeboxes\n\t    \t\t\t\t\t\t\t});\n  };\n\n  \tcheckForInProgressTimeboxes = (timeboxes) => {\n  \t\ttimeboxes.forEach(timebox => {\n    \tif (timebox.status === 'In Progress') {\n    \t\tthis.setState({timeboxRedirect: timebox.id, ipTimeboxName: timebox.title})\n    \t}\n    \tthis.setState({dataReceived: true})\n    })\n\n  \t}\n\n   \tasync componentDidMount() {\n   \t\tconst sp = new URLSearchParams(this.props.location.query);\n\t\t\tconst projectId = Number(sp.get(\"projectId\"))\n\t\t\tif (projectId === null || projectId === 0) {\n\t\t\t\tthis.props.history.push('/')\n\t\t\t} else {\n\t\t\t\tthis.setState({projectId: projectId})\n\t\t\t\tawait this.getTasks(projectId);\n\t\t\t\tthis.checkForInProgressTimeboxes(this.state.timeboxes) //why is this function essential for rendrering anything????\n\t\t\t}\n\n    }\n\n    onDragEnd = async (result) => {\n\n  \t\tconst {destination, source, draggableId} = result;\n\n  \t\tif (!destination) {\n  \t\t\t//dragging somewhere non-droppable\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (\n  \t\t\t//dragging and dropping into same place\n  \t\t\tdestination.droppableId === source.droppableId &&\n  \t\t\tdestination.index === source.index\n  \t\t\t) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tconst taskId = Number(draggableId)\n  \t\tconst obj = this.state.tasks.find(o => o.id === taskId);\n\n  \t\tif (destination.droppableId.slice(0,5) === 'Theme') {\n  \t\t\t//landed on a theme, keep timebox the same and update the theme\n  \t\t\tconst themeId = Number(destination.droppableId.slice(6,11))\n\t\t\t\tconst data = {\n\t  \t\t\tproject_id: this.state.projectId,\n\t  \t\t\ttask_id: taskId,\n\t  \t\t\ttheme_id: themeId\n\t\t\t\t}\n\t\t\t\tpostRequest('/update_task_theme', data)\n\n\t  \t\tconst themeObj = this.state.themes.find(o => o.id === themeId)\n\n\t  \t\tobj.theme = themeObj.title\n\t  \t\tobj.theme_color = themeObj.color\n\n  \t\t}\n\n  \t\telse if (destination.droppableId.slice(0,7) === 'Timebox') {\n  \t\t\t//landed in a timebox - get timebox, remove from tasks, update timebox and put back in new position\n  \t\t\tconst timebox = destination.droppableId.slice(8,)\n\t\t\t\tconst data = {\n\t\t\t\t\tproject_id: this.state.projectId,\n\t\t\t\t\ttask_id: taskId,\n\t\t\t\t\tpriority: result.destination.index,\n\t\t\t\t\ttimebox: timebox\n\t\t\t\t}\n\t\t\t\tpostRequest('/update_task', data)\n\n\t  \t\tobj.timebox = timebox\n\n\t\t  \tconst newTasks = this.state.tasks.filter(t => t !== obj)\n\t\t\t\tnewTasks.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: newTasks,\n\t\t    \tvisibleTasks: newTasks\n\t\t    \t})\n\t\t\t}\n\n\t\t\telse if (destination.droppableId === 'Backlog') {\n\t\t\t\t//landed in backlog - remove from source list, add to backlog and update state with all the updated lists\n\t\t\t\tconst data = {\n\t  \t\t\tproject_id: this.state.projectId,\n\t  \t\t\ttask_id: taskId,\n\t  \t\t\tpriority: result.destination.index,\n\t  \t\t\ttimebox: destination.droppableId\n\t  \t\t}\n\t\t\t\tpostRequest('/update_task', data)\n\n\t  \tconst destinationList = this.state.tasks.filter(t => t.timebox === destination.droppableId);\n\t  \tconst otherTasks = this.state.tasks.filter(t => t.timebox !== destination.droppableId);\n\n\t\t\tif (source.droppableId === destination.droppableId) {\n\t\t\t\t//same list so simply take it out and put it bakc in new position\n\t\t\t\tlet backlogTasks = this.state.tasks.filter(t => t.timebox === source.droppableId);\n\t\t\t\tbacklogTasks = this.state.tasks.filter(t => t !== obj);\n\n\t\t\t\tbacklogTasks.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: backlogTasks,\n\t\t    \tvisibleTasks: backlogTasks\n\t\t    \t})\n\n\t\t\t} else {\n\t\t\t\t//moving from timebox to backlog so remove from source, add to backlog at index and all tasks back to state\n\t\t\t\tobj.timebox = 'Backlog'\n\n\t\t\t\tthis.setState({\n\t\t    \ttasks: [...otherTasks, ...destinationList],\n\t\t    \tvisibleTasks: [ ...otherTasks, ...destinationList]\n\t\t    \t})\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('Unexpected drop destination')\n\t\t}\n\n  \t}\n\n\n\trender() {\n\t\treturn   this.state.dataReceived === true ? (\n\t\t\t\t\t\t<DragDropContext\n\t\t\t\t\t\t\tonDragEnd = {this.onDragEnd}\n\t\t\t\t\t\t\tonDragUpdate={this.onDragUpdate}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className='board row mt-5' style={{margin: 0}}>\n\t\t\t\t\t\t\t\t<Themes\n\t\t\t\t\t\t\t\t\tthemes={this.state.themes}\n\t\t\t\t\t\t\t\t\tfilterByTheme={this.filterByTheme}\n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t\taddTheme={this.addTheme}\n\t\t\t\t\t\t\t\t\tdeleteTheme={this.deleteTheme}\n\t\t\t\t\t\t\t\t\tfiltering={this.state.filtering}\n\t\t\t\t\t\t\t\t\tclearFilters={this.clearFilters}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Backlog\n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t  tasks={this.state.visibleTasks}\n\t\t\t\t\t\t\t\t  addTask={this.addTask}\n\t\t\t\t\t\t\t\t  deleteTask={this.deleteTask}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Timeboxes\n\t\t\t\t\t\t\t\t\taddTimebox={this.addTimebox}\n\t\t\t\t\t\t\t\t\ttimeboxes={this.state.timeboxes}\n\t\t\t\t\t\t\t\t\ttasks={this.state.visibleTasks}\n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t \t</div>\n\t\t\t\t\t\t</DragDropContext>\n\t\t\t\t\t\t)\n\t\t\t\t\t: <div></div>\n\t}\n}\n\n\nexport { Board }\n"]},"metadata":{},"sourceType":"module"}
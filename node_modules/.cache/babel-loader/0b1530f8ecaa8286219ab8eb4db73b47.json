{"ast":null,"code":"var _jsxFileName = \"/Users/markgray/projects/todoodleoo/src/Board/Board.js\";\nimport React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport 'bootstrap';\nimport axios from 'axios';\nimport './board.css';\nimport Themes from './../Themes/Themes.js';\nimport Backlog from './../Backlog/Backlog.js';\nimport Timeboxes from './../Timeboxes/Timeboxes.js';\nimport TasksArea from './../Task/TasksArea.js';\nimport { DragDropContext } from 'react-beautiful-dnd';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Board extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.addTask = taskData => {\n      const newTask = { ...taskData\n      };\n      this.setState(prevState => ({\n        tasks: [newTask, ...this.state.tasks],\n        visibleTasks: [newTask, ...this.state.tasks]\n      }));\n    };\n\n    this.addTimebox = timebox => {\n      this.setState(prevState => ({\n        timeboxes: [...this.state.timeboxes, timebox]\n      }));\n    };\n\n    this.addTheme = themeData => {\n      this.setState(prevState => ({\n        themes: [...this.state.themes, themeData]\n      }));\n    };\n\n    this.deleteTask = taskId => {\n      axios.post('/delete_task', {\n        task_id: taskId,\n        project_id: this.state.projectId\n      });\n      const tasks = this.state.tasks.filter(t => t.id !== taskId);\n      this.setState(prevState => ({\n        tasks: tasks,\n        visibleTasks: tasks\n      }));\n    };\n\n    this.deleteTheme = themeId => {\n      axios.post('/delete_theme', {\n        theme_id: themeId,\n        project_id: this.state.projectId\n      });\n      const themes = this.state.themes.filter(t => t.id !== themeId);\n      this.setState(prevState => ({\n        themes: themes\n      }));\n    };\n\n    this.filterByTheme = theme => {\n      const filteredTasks = this.state.tasks.filter(task => task.theme === theme);\n      const nonFilteredTasks = this.state.tasks.filter(task => task.theme !== theme);\n      this.setState(prevState => ({\n        visibleTasks: filteredTasks,\n        filtering: true\n      }));\n    };\n\n    this.clearFilters = () => {\n      this.setState({\n        visibleTasks: this.state.tasks,\n        filtering: false\n      });\n    };\n\n    this.getTasks = async projectId => {\n      const resp = await axios.get(`/get_tasks?project_id=${projectId}`);\n      const timeboxes = resp.data['timeboxes'];\n      const themes = resp.data['themes'];\n      this.setState({\n        tasks: resp.data['tasks'],\n        visibleTasks: resp.data['tasks'],\n        themes: themes,\n        timeboxes: timeboxes\n      });\n    };\n\n    this.onDragEnd = async result => {\n      const {\n        destination,\n        source,\n        draggableId\n      } = result;\n\n      if (!destination) {\n        return;\n      }\n\n      if (destination.droppableId === source.droppableId && destination.index === source.index) {\n        return;\n      }\n\n      const taskId = Number(draggableId);\n      const obj = this.state.tasks.find(o => o.id === taskId);\n\n      if (destination.droppableId.slice(0, 5) === 'Theme') {\n        const themeId = Number(destination.droppableId.slice(6, 11));\n        axios.post('/update_task_theme', {\n          project_id: this.state.projectId,\n          task_id: taskId,\n          theme_id: themeId\n        });\n        const themeObj = this.state.themes.find(o => o.id === themeId);\n        obj.theme = themeObj.title;\n        obj.theme_color = themeObj.color;\n      } else if (destination.droppableId.slice(0, 10) === 'Timebox') {\n        console.log(\"i'm in a timebox\");\n      } else {\n        console.log('destination:', destination.droppableId);\n        axios.post('/update_task', {\n          project_id: this.state.projectId,\n          task_id: taskId,\n          priority: result.destination.index,\n          timebox: destination.droppableId\n        });\n        let sourceList = this.state.tasks.filter(t => t.timebox === source.droppableId);\n        const destinationList = this.state.tasks.filter(t => t.timebox === destination.droppableId);\n        const otherList = this.state.tasks.filter(t => t.timebox !== source.droppableId);\n        const reorderedItem = this.state.tasks.find(t => String(t.id) === result.draggableId);\n\n        if (source.droppableId === destination.droppableId) {\n          const newTasks = this.state.tasks.filter(t => t !== obj);\n          newTasks.splice(result.destination.index, 0, obj);\n          this.setState({\n            tasks: newTasks\n          });\n        } else {\n          obj.timebox = destination.droppableId;\n          const newSourceList = sourceList.filter(t => t !== obj);\n          const newDestinationList = destinationList.splice(result.destination.index, 0, obj);\n          this.setState({\n            tasks: [...newSourceList, ...destinationList],\n            visibleTasks: [...newSourceList, ...destinationList]\n          });\n        }\n      }\n    };\n\n    this.state = {\n      dataReceived: false\n    };\n  }\n\n  async componentDidMount() {\n    const sp = new URLSearchParams(this.props.location.query);\n    const projectId = Number(sp.get(\"projectId\"));\n\n    if (projectId === null || projectId === 0) {\n      this.props.history.push('/');\n    } else {\n      this.setState({\n        projectId: projectId\n      });\n      await this.getTasks(projectId);\n    }\n  }\n\n  render() {\n    return this.state.dataReceived === true ? /*#__PURE__*/_jsxDEV(DragDropContext, {\n      onDragEnd: this.onDragEnd,\n      onDragUpdate: this.onDragUpdate,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"board row mt-5\",\n        style: {\n          margin: 0\n        },\n        children: [/*#__PURE__*/_jsxDEV(Themes, {\n          themes: this.state.themes,\n          filterByTheme: this.filterByTheme,\n          projectId: this.state.projectId,\n          addTheme: this.addTheme,\n          deleteTheme: this.deleteTheme,\n          filtering: this.state.filtering,\n          clearFilters: this.clearFilters\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Backlog, {\n          projectId: this.state.projectId,\n          tasks: this.state.tasks,\n          addTask: this.addTask\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Timeboxes, {\n          addTimebox: this.addTimebox,\n          timeboxes: this.state.timeboxes,\n          tasks: this.state.tasks,\n          projectId: this.state.projectId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 8\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 8\n    }, this);\n  }\n\n}\n\nexport { Board };","map":{"version":3,"sources":["/Users/markgray/projects/todoodleoo/src/Board/Board.js"],"names":["React","Redirect","axios","Themes","Backlog","Timeboxes","TasksArea","DragDropContext","Board","Component","constructor","props","addTask","taskData","newTask","setState","prevState","tasks","state","visibleTasks","addTimebox","timebox","timeboxes","addTheme","themeData","themes","deleteTask","taskId","post","task_id","project_id","projectId","filter","t","id","deleteTheme","themeId","theme_id","filterByTheme","theme","filteredTasks","task","nonFilteredTasks","filtering","clearFilters","getTasks","resp","get","data","onDragEnd","result","destination","source","draggableId","droppableId","index","Number","obj","find","o","slice","themeObj","title","theme_color","color","console","log","priority","sourceList","destinationList","otherList","reorderedItem","String","newTasks","splice","newSourceList","newDestinationList","dataReceived","componentDidMount","sp","URLSearchParams","location","query","history","push","render","onDragUpdate","margin"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport 'bootstrap';\nimport axios from 'axios';\nimport './board.css';\nimport Themes from './../Themes/Themes.js'\nimport Backlog from './../Backlog/Backlog.js'\nimport Timeboxes from './../Timeboxes/Timeboxes.js'\nimport TasksArea from './../Task/TasksArea.js'\nimport { DragDropContext } from 'react-beautiful-dnd';\n\nclass Board extends React.Component {\n\tconstructor(props) {\n\t    super(props);\n\t    this.state = {\n\t        dataReceived: false\n\t    };\n\t  }\n\n\taddTask = (taskData) => {\n\t\tconst newTask = {...taskData}\n\t\tthis.setState(prevState => ({\n    \t\ttasks: [newTask, ...this.state.tasks],\n    \t\tvisibleTasks: [newTask, ...this.state.tasks]\n    \t}));\n  \t};\n\n  \taddTimebox = (timebox) => {\n  \t\tthis.setState(prevState => ({\n    \t\ttimeboxes: [...this.state.timeboxes, timebox]\n    \t}));\n  \t}\n\n  \taddTheme = (themeData) => {\n  \t\tthis.setState(prevState => ({\n    \t\tthemes: [...this.state.themes, themeData],\n    \t\t}));\n  \t}\n\n  \tdeleteTask = (taskId) => {\n  \t\taxios.post('/delete_task', {\n  \t\t\ttask_id: taskId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t})\n  \t\tconst tasks = this.state.tasks.filter(t => t.id !== taskId)\n  \t\tthis.setState(prevState => ({\n\t\t    \ttasks: tasks,\n\t\t    \tvisibleTasks: tasks\n\t\t    }));\n  \t}\n\n  \tdeleteTheme = (themeId) => {\n  \t\taxios.post('/delete_theme', {\n  \t\t\ttheme_id: themeId,\n  \t\t\tproject_id: this.state.projectId\n  \t\t})\n  \t\tconst themes = this.state.themes.filter(t => t.id !== themeId)\n  \t\tthis.setState(prevState => ({\n\t\t    \tthemes: themes,\n\t\t    }));\n  \t}\n\n  \tfilterByTheme = (theme) => {\n\t  \t\tconst filteredTasks = this.state.tasks.filter(task => task.theme === theme);\n\t  \t\tconst nonFilteredTasks = this.state.tasks.filter(task => task.theme !== theme);\n\t  \t\tthis.setState(prevState => ({\n\t\t    \tvisibleTasks: filteredTasks,\n\t\t    \tfiltering: true\n\t\t    }));\t\n  \t}\n\n  \tclearFilters = () => {\n  \t\tthis.setState({visibleTasks: this.state.tasks, filtering: false})\n  \t}\n\n  \tgetTasks = async (projectId) => {\n    const resp = await axios.get(`/get_tasks?project_id=${projectId}`)\n    const timeboxes = resp.data['timeboxes']\n    const themes = resp.data['themes']\n    this.setState({ tasks: resp.data['tasks'],\n    \t\t\t\t\t\t\t\tvisibleTasks: resp.data['tasks'], \n    \t\t\t\t\t\t\t\tthemes:themes, \n    \t\t\t\t\t\t\t\ttimeboxes: timeboxes \n    \t\t\t\t\t\t\t});\n  };\n\n  \t\n   \tasync componentDidMount() {\n   \t\tconst sp = new URLSearchParams(this.props.location.query);\n\t\t\tconst projectId = Number(sp.get(\"projectId\"))\n\t\t\tif (projectId === null || projectId === 0) {\n\t\t\t\tthis.props.history.push('/')\n\t\t\t} else {\n\t\t\t\tthis.setState({projectId: projectId})\n\t\t\t\tawait this.getTasks(projectId);\n\t\t\t}\n    \t\n    }\n\n    onDragEnd = async (result) => {\n\n  \t\tconst {destination, source, draggableId} = result;\n\n  \t\tif (!destination) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (\n  \t\t\tdestination.droppableId === source.droppableId &&\n  \t\t\tdestination.index === source.index\n  \t\t\t) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tconst taskId = Number(draggableId)\n  \t\tconst obj = this.state.tasks.find(o => o.id === taskId);\n\n  \t\tif (destination.droppableId.slice(0,5) === 'Theme') {\n  \t\t\tconst themeId = Number(destination.droppableId.slice(6,11))\n  \t\t\taxios.post('/update_task_theme', {\n  \t\t\tproject_id: this.state.projectId,\n  \t\t\ttask_id: taskId,\n  \t\t\ttheme_id: themeId\n  \t\t\t})\n\n\t  \t\tconst themeObj = this.state.themes.find(o => o.id === themeId)\n\n\t  \t\tobj.theme = themeObj.title\n\t  \t\tobj.theme_color = themeObj.color\n\n  \t\t} else if (destination.droppableId.slice(0,10) === 'Timebox') {\n  \t\t\tconsole.log(\"i'm in a timebox\")\n  \t\t}\n\n  \t\telse {\n  \t\t\tconsole.log('destination:', destination.droppableId)\n  \t\t\n\t  \t\t\n\t  \t\t  axios.post('/update_task', {\n\t  \t\t\tproject_id: this.state.projectId,\n\t  \t\t\ttask_id: taskId,\n\t  \t\t\tpriority: result.destination.index,\n\t  \t\t\ttimebox: destination.droppableId\n\t  \t\t})\n\t  \tlet sourceList = this.state.tasks.filter(t => t.timebox === source.droppableId);\n\t  \tconst destinationList = this.state.tasks.filter(t => t.timebox === destination.droppableId);\n\t  \tconst otherList = this.state.tasks.filter(t => t.timebox !== source.droppableId);\n\t\t\tconst reorderedItem = this.state.tasks.find(t => String(t.id) === result.draggableId);\n\t\t\tif (source.droppableId === destination.droppableId) {\n\t\t\t\tconst newTasks = this.state.tasks.filter(t => t !== obj)\n\t\t\t\tnewTasks.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: newTasks\n\t\t    \t})\n\t\t\t} else {\n\t\t\t\tobj.timebox = destination.droppableId\n\n\t\t\t\tconst newSourceList = sourceList.filter(t => t !== obj)\n\t\t\t\tconst newDestinationList = destinationList.splice(result.destination.index,0, obj)\n\t\t\t\tthis.setState({\n\t\t    \ttasks: [...newSourceList, ...destinationList],\n\t\t    \tvisibleTasks: [...newSourceList, ...destinationList]\n\t\t    \t})\n\t\t\t}\n\t\t}\n  \t\t\t\t\n  \t}\n\n\n\n\trender() {\n\t\treturn   this.state.dataReceived === true ? (\n\t\t\t\t\t\t<DragDropContext\n\t\t\t\t\t\t\tonDragEnd = {this.onDragEnd}\n\t\t\t\t\t\t\tonDragUpdate={this.onDragUpdate}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className='board row mt-5' style={{margin: 0}}>\n\t\t\t\t\t\t\t\t<Themes \n\t\t\t\t\t\t\t\t\tthemes={this.state.themes} \n\t\t\t\t\t\t\t\t\tfilterByTheme={this.filterByTheme} \n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t\taddTheme={this.addTheme}\n\t\t\t\t\t\t\t\t\tdeleteTheme={this.deleteTheme}\n\t\t\t\t\t\t\t\t\tfiltering={this.state.filtering}\n\t\t\t\t\t\t\t\t\tclearFilters={this.clearFilters}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Backlog \n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t  tasks={this.state.tasks}\n\t\t\t\t\t\t\t\t  addTask={this.addTask}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Timeboxes \n\t\t\t\t\t\t\t\t\taddTimebox={this.addTimebox}\n\t\t\t\t\t\t\t\t\ttimeboxes={this.state.timeboxes}\n\t\t\t\t\t\t\t\t\ttasks={this.state.tasks}\n\t\t\t\t\t\t\t\t\tprojectId={this.state.projectId}\n\t\t\t\t\t\t\t\t/>\t\t\n\t\t\t\t\t\t \t</div>\n\t\t\t\t\t\t</DragDropContext> \n\t\t\t\t\t\t)\n\t\t\t\t\t: <div></div>\n\t}\n}\n\n\nexport { Board }\n"]},"metadata":{},"sourceType":"module"}